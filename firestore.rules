rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /slides/{slide} {
      allow get: if true;
      allow delete, list: if false;

      allow create:
        if request.resource.data.keys().hasOnly(
          ['createdAt', 'markdown', 'presentationId', 'theme']
        )
        && request.resource.data.createdAt == request.time
        && request.resource.data.markdown is string
        && request.resource.data.presentationId is string
        && request.resource.data.theme == 'default';

      allow update:
        if request.resource.data.diff(resource.data).affectedKeys().hasOnly(
          ['markdown', 'theme']
        )
        && request.resource.data.markdown is string
        && request.resource.data.theme == 'default';

      // match /images/{image} {
      //   allow get, delete, list, update: if false;
      //   allow create: if true;
      // }
    }
  }
}
